(function(t){function h(n){t("#ftven_formabo_close").click(function(){t("#ftven_formabo").dialog("close");return false});t("#ftven_formabo_form_submit").click(function(){t("#ftven_formabo_form").submit();return false;e.preventDefault()});t("#ftven_formabo_form_email").keypress(function(e){if(e.which==13){t("#ftven_formabo_form_submit").click()}});t("#ftven_formabo_form").submit(function(n){if(""===t("#ftven_formabo_option").val()){return false}var r=x();if(false===r){p(r,"Adresse email incorrecte");return false}if(1===l){m();return false}if(false===N()){return false}if(r===true){var i=t("#ftven_formabo_form input:checked").map(function(){return{optin:this.value,action:"A"}}).get();var s={email:a,detailSource:c,json:i};t.ajax({type:"POST",dataType:"json",url:o,data:JSON.stringify(s),success:function(e){t.each(e,function(e,t){T(t,r)})}})}return false;e.preventDefault()})}function p(e,n){var r=t("#ftven_formabo_message");if(e===false){r.children().remove();r.append("<div class='ftven_error_message'><p>"+n+"</p></div>");t("#ftven_formabo_form_email").addClass("ftven_formabo_email_error")}else{r.children().remove();r.append("<div class='ftven_success_message'><p>"+n+"</p></div>");t("#ftven_formabo_form_email").removeClass("ftven_formabo_email_error")}t("#ftven_formabo_message").show()}function d(e,t,n){var r="expires="+n.toGMTString();document.cookie=e+"="+t+"; "+r+";path=/"}function v(e){var t=e+"=",n=document.cookie.split(";"),r=n.length;for(var i=0;i<r;i++){var s=n[i].trim();if(s.indexOf(t)==0){return s.substring(t.length,s.length)}}return""}function m(){var e={optin:t("#ftven_formabo_option").val(),action:"A"};var n=x();if(n===true){var r={email:a,detailSource:c,json:e};t.ajax({type:"POST",dataType:"json",url:o,data:JSON.stringify(r),success:function(e){t.each(e,function(e,t){T(t,n)})},error:function(e,t,n){console.log(e.status);console.log(n);console.log(JSON.stringify(r))}})}else{p(n,"Adresse email incorrecte")}}function g(e,t){return'<div class="ftven_formabo_content_2NL">'+'<div class="ftven_formabo_picture">'+'<img src="'+e.produit_picture+'"  />'+"</div>"+'<div class="ftven_formabo_subscription ">'+'<div class="ftven_formabo_product_descritpion">'+"<p>"+e.produit_description+"</p>"+"</div>"+'<div class="ftven_formabo_subscription_choice">'+y(t,e.produit_optin_name)+"</div>"+"</div>"+"</div>"}function y(e,t){return'<div class="ftven_formabo_checkbox">'+'<input id="ftven_formabo_option'+e+'_cb" type="checkbox" value="'+t+'" class="ftven_formabo_checkbox">'+'<label for="ftven_formabo_option'+e+'_cb">'+'<span  class="ftven_formabo_option" id="ftven_formabo_option'+e+'">'+"<span></span>"+"</span>"+"</label>"+'<div id="ftven_formabo_option'+e+'_cb_choose" class="ftven_formabo_option_choose_txt">'+"<p >Je souhaite m’abonner à la newsletter</p>"+"</div>"+"</div>"}function b(){return'<div class="ftven_formabo_mail_block">'+'<input type="text" id="ftven_formabo_form_email" placeholder="Saisissez votre adresse email"/>'+"</div>"+'<div class="ftven_formabo_mail_button">'+'<a href="#" id="ftven_formabo_form_submit" class="ftven_formabo_form_submit_link">S\'abonner</a>'+"</div>"}function w(){var e=u+i+":"+s;t.ajax({async:true,cache:true,jsonpCallback:"callbackJsonpFormAbo",contentType:"application/json",dataType:"jsonp",type:"GET",url:e,success:function(e){var n,r,i;var s=Object.keys(e);l=s.length;var o=""+'<div id="ftven_formabo_footer">'+'<div id="ftven_formabo_message" class="ftven_success_message">'+"<p>Inscription réussie</p>"+"</div>"+'<div id="ftven_formabo_collecte_info" class="ftven_collecte_info">'+"<p>FRANCE TELEVISIONS, en sa qualité de responsable du traitement, collecte vos données à caractère personnel à des fins de gestion de votre compte utilisateur. Ces données sont nécessaires pour pouvoir vous offrir un espace personnalisé. Conformément à la loi Informatique et libertés du 6 janvier 1978, vous bénéficiez d'un droit d'accès, de rectification et de suppression de vos données. Vous pouvez également vous opposer, pour un motif légitime, à l'utilisation de vos données. Vous seul pouvez exercer ces droits sur vos propres données en écrivant à France Télévisions - Editions Numériques Service Inscription Internet - 7 Esplanade Henri de France 75015 Paris et en joignant une photocopie de votre pièce d'identité</p>"+"</div>"+"</div>";if(2<=l){var u=""+'<div id="ftven_formabo_header">'+'<div id="ftven_formabo_title">'+"<h1>S'abonner à la newsletter</h1>"+'<button type="button" id="ftven_formabo_close"></button>'+"</div>"+'<div id="ftven_formabo_francetv" class="ftven_main_logo">'+"</div>"+"</div>";var a=e[s[0]];var f=e[s[1]];r='<div id="ftven_formabo_main_content">'+'<form id="ftven_formabo_form">'+g(a,1)+'<hr class="ftven_formabo_separator">'+g(f,2)+'<div class="ftven_formabo_email_bloc_submit2NL">'+b()+"</div>"+"</form>"+"</div>";var c=800;var p=960}else if(1==l){var a=e[s[0]];var u=""+'<div id="ftven_formabo_header">'+'<div id="ftven_formabo_title"><h1>S\'abonner à la newsletter</h1>'+'<button type="button" id="ftven_formabo_close"></button>'+"</div>"+'<div id="ftven_formabo_'+a.produit_logo+'" class="ftven_main_logo">'+"</div>"+"</div>";var d=a.produit_print_title=="1"?'<h3 class="ftven_formabo_product_name">'+a.produit_name+"</h3>":"";var v=a.produit_name!=""?"_with_title":"";r='<div class="ftven_formabo_content_1NL">'+'<div class="ftven_formabo_picture">'+'<img src="'+a.produit_picture+'"  />'+"</div>"+'<div class="ftven_formabo_subscription ">'+d+'<div class="ftven_formabo_product_descritpion'+v+'"><p>'+a.produit_description+"</p></div>"+'<div class="ftven_formabo_email_bloc_submit1NL">'+'<form id="ftven_formabo_form">'+'<input type="hidden" id="ftven_formabo_option" value="'+a.produit_optin_name+'"/>'+b()+"</form>"+"</div>"+"</div>"+"</div>";var c=800;var p=600}i='<div id="ftven_formabo">'+u+r+o+"</div>";t("body").prepend(i);E(c,p);h(e);t("#ftven_formabo_message").hide();t("#ftven_formabo_option1_cb_ok").hide();t("#ftven_formabo_option2_cb_ok").hide()},error:function(e,t,n){console.log(e.status);console.log(n)}})}function E(e,n){t("#ftven_formabo").dialog({autoOpen:true,modal:true,draggable:false,resizable:false,closeOnEscape:true,width:e,height:n,show:{effect:"blind",duration:1e3}})}function S(){var e=6==r?6:5;var t=new Date;t.setDate(n.getDate()+e);t.setHours(23,59,59);return t}function x(){a=t("#ftven_formabo_form_email").val();var e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return e.test(a)}function T(e,r){if(e.statut=="OK"){f=true;p(r,"Inscription réussie");t("#ftven_formabo_form_submit").unbind("click");t("#ftven_formabo_form_submit").unbind("hover");t("#ftven_formabo_form_submit").addClass("ftven_formabo_form_submit_finish");var o=new Date;o.setDate(n.getDate()+365);d("ftven-nl-"+i+"_"+s+"_done",1,o)}else{if(false===f){p(false,"Email déjà existant")}}}function N(){if(0===t("#ftven_formabo_form input:checked").length){p(false,"Vous devez sélectionner au moins 1 abonnement");return false}else{return true}}var n=new Date;var r=n.getDay();var i=t("meta[name=archimade_idsite]").attr("content");var s=t("meta[name=archimade_token]").attr("content");var o="http://api.lereferentiel.francetv.fr/users/formulaire-abonnement-newsletter/neolane/subscription";var u="http://api.lereferentiel.francetv.fr/pages/formulaire-abonnement-newsletter/configuration/";var a;var f=false;var l;var c;t(document).ready(function(){if(1!=v("ftven-nl-"+i+"_"+s)&&(6===r||0===r)&&1!=v("ftven-nl-"+i+"_"+s+"_done")){c="popin,idSite="+i+",token="+s;w();d("ftven-nl-"+i+"_"+s,1,S())}})})(jQuery)