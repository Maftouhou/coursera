(function(e){"use strict";function m(){e("#ftven_formabo_form_email").blur(function(){if(this.value===""){this.value="Saisissez votre adresse email"}}).focus(function(){if(this.value==="Saisissez votre adresse email"){this.value=""}});e("#ftven_formabo_close").click(function(){e("#ftven_formabo").dialog("close");return false});e("#ftven_formabo_form_submit").click(function(){e("#ftven_formabo_form").submit();return false});e("#ftven_formabo_form_email").keypress(function(t){if(this.value&&this.value.indexOf('Saisissez votre adresse email')>=0){this.value=this.value.replace('Saisissez votre adresse email','');}if(t.which===13){e("#ftven_formabo_form_submit").click()}});e("#ftven_formabo_form").submit(function(){if(""===e("#ftven_formabo_option").val()){return false}var t=O();if(false===t){g(t,"Adresse email incorrecte");return false}if(1===f){w();return false}if(false===_()){return false}if(t===true){var n=e("#ftven_formabo_form input:checked").map(function(){return{optin:this.value,action:"A"}}).get();var r={email:u,detailSource:l,json:n};e.ajax({type:"POST",dataType:"json",url:s,data:JSON.stringify(r),success:function(n){e.each(n,function(e,n){M(n,t)})}})}return false})}function g(t,n){var r=e("#ftven_formabo_message");if(t===false){r.children().remove();r.append("<div class='ftven_error_message'><p>"+n+"</p></div>");e("#ftven_formabo_form_email").addClass("ftven_formabo_form_email_error")}else{r.children().remove();r.append("<div class='ftven_success_message'><p>"+n+"</p></div>");e("#ftven_formabo_form_email").removeClass("ftven_formabo_form_email_error")}e("#ftven_formabo_message").show()}function y(e,t,n){var r="expires="+n.toGMTString();document.cookie=e+"="+t+"; "+r+";path=/"}function b(e){var t=e+"=",n=document.cookie.split(";"),r=n.length;for(var i=0;i<r;i++){var s=n[i].trim();if(s.indexOf(t)===0){return s.substring(t.length,s.length)}}return""}function w(){var t={optin:e("#ftven_formabo_option").val(),action:"A"};var n=O();if(n===true){var r={email:u,detailSource:l,json:t};e.ajax({type:"POST",dataType:"json",url:s,data:JSON.stringify(r),success:function(t){e.each(t,function(e,t){M(t,n)})},error:function(e,t,n){console.log(e.status);console.log(n);console.log(JSON.stringify(r))}})}else{g(n,"Adresse email incorrecte")}}function E(e,t){return'<div class="ftven_formabo_content_2NL">'+'<div class="ftven_formabo_picture_2NL">'+'<img src="'+e.produit_picture+'"  />'+"</div>"+'<div class="ftven_formabo_subscription ">'+'<div class="ftven_formabo_product_descritpion_2NL">'+'<p class="ftven_formabo_product_descritpion_block">'+e.produit_description+"</p>"+"</div>"+'<div class="ftven_formabo_subscription_choice">'+S(t,e.produit_optin_name)+"</div>"+"</div>"+"</div>"}function S(e,t){return'<div class="ftven_formabo_checkbox">'+'<input id="ftven_formabo_option'+e+'_cb" type="checkbox" value="'+t+'" class="ftven_formabo_checkbox">'+'<label for="ftven_formabo_option'+e+'_cb">'+'<span  class="ftven_formabo_option" id="ftven_formabo_option'+e+'">'+"<span></span>"+"</span>"+"</label>"+'<div id="ftven_formabo_option'+e+'_cb_choose" class="ftven_formabo_option_choose_txt">'+"<p >Je souhaite m'abonner à la newsletter</p>"+"</div>"+"</div>"}function x(){return'<div class="ftven_formabo_mail_block">'+'<input type="text" id="ftven_formabo_form_email"  value="Saisissez votre adresse email"/>'+"</div>"+'<div class="ftven_formabo_mail_button">'+'<a href="#" id="ftven_formabo_form_submit" class="ftven_formabo_form_submit_link">S\'abonner</a>'+"</div>"}function T(e){var t=Object.keys(e);f=t.length;c=e[t[0]];p=c.produit_optin_name;d="auto";v=650;if(1!==f){h=e[t[1]];d="auto";v=735;p+="_"+h.produit_optin_name}}function N(t){var s=o+r+":"+i;e.ajax({async:true,cache:true,jsonpCallback:"callbackJsonpFormAbo",contentType:"application/json",dataType:"jsonp",type:"GET",url:s,success:function(o){if(typeof o.message!="undefined"&&o.message==="unavailable configuration for this site"){console.log("[POPIN NL] - no popin bad configuration");console.log("[POPIN NL] - DEBUG :"+JSON.stringify(o));console.log("[POPIN NL] - URL TO CHECK DATA :"+s)}else{T(o);if(t===true){C();m();e("#ftven_formabo_message").hide();e("#ftven_formabo_option1_cb_ok").hide();e("#ftven_formabo_option2_cb_ok").hide()}else{if(1!=b("ftven-nl-"+r+"_"+p)&&(6===n||0===n)&&1!=b("ftven-nl-"+r+"_"+p+"_done")){l="popin,idSite="+r+",token="+i;C();m();e("#ftven_formabo_message").hide();e("#ftven_formabo_option1_cb_ok").hide();e("#ftven_formabo_option2_cb_ok").hide();y("ftven-nl-"+r+"_"+p,1,A())}}}},error:function(e,t,n){console.log(e.status);console.log(n)}})}function C(){var t,n,r="";var i=""+'<div id="ftven_formabo_footer">'+'<div id="ftven_formabo_message" class="ftven_success_message">'+"<p>Inscription réussie</p>"+"</div>"+'<div id="ftven_formabo_collecte_info" class="ftven_collecte_info">'+"<p>FRANCE TELEVISIONS, en sa qualité de responsable du traitement, collecte vos données à caractère personnel à des fins de gestion de votre compte utilisateur. Ces données sont nécessaires pour pouvoir vous offrir un espace personnalisé. Conformément à la loi Informatique et libertés du 6 janvier 1978, vous bénéficiez d'un droit d'accès, de rectification et de suppression de vos données. Vous pouvez également vous opposer, pour un motif légitime, à l'utilisation de vos données. Vous seul pouvez exercer ces droits sur vos propres données en écrivant à France Télévisions - Editions Numériques Service Inscription Internet - 7 Esplanade Henri de France 75015 Paris et en joignant une photocopie de votre pièce d'identité</p>"+"</div>"+"</div>";if(2<=f){r=k("francetv");t='<div id="ftven_formabo_main_content">'+'<form id="ftven_formabo_form">'+E(c,1)+'<hr class="ftven_formabo_h_separator">'+E(h,2)+'<div class="ftven_formabo_email_bloc_submit2NL">'+x()+"</div>"+"</form>"+"</div>"}else if(1==f){r=k(c.produit_logo);var s=c.produit_print_title=="1"?'<h3 class="ftven_formabo_product_name">'+c.produit_name+"</h3>":"";var o=c.produit_name!=""&&c.produit_print_title=="1"?"_with_title":"";t='<div class="ftven_formabo_content_1NL">'+'<div class="ftven_formabo_picture">'+'<img src="'+c.produit_picture+'"  />'+"</div>"+'<div class="ftven_formabo_subscription'+o+'">'+s+'<div class="ftven_formabo_product_descritpion'+o+'"><p class="ftven_formabo_product_descritpion_block">'+c.produit_description+"</p></div>"+'<div class="ftven_formabo_email_bloc_submit1NL">'+'<form id="ftven_formabo_form">'+'<input type="hidden" id="ftven_formabo_option" value="'+c.produit_optin_name+'"/>'+x()+"</form>"+"</div>"+"</div>"+"</div>"}n='<div id="ftven_formabo">'+r+t+i+"</div>";e("body").prepend(n);L(d,v)}function k(e){return'<div id="ftven_formabo_header">'+'<div id="ftven_formabo_title">'+"<h1>S'abonner à la newsletter</h1>"+"</div>"+'<div class="ftven_main_logo">'+'<div class="ftven_formabo_separator">'+"</div>"+'<div id="ftven_formabo_'+e+'">'+"</div>"+'<div class="ftven_formabo_v_separator">'+"</div>"+'<div class="ftven_formabo_close" id="ftven_formabo_close">'+"</div>"+"</div>"+"</div>"}function L(t,n){e("#ftven_formabo").dialog({autoOpen:true,modal:true,draggable:false,resizable:false,closeOnEscape:true,width:t,height:n,show:{duration:1e3}})}function A(){var e=6==n?6:5;var r=new Date;r.setDate(t.getDate()+e);r.setHours(23,59,59);return r}function O(){u=e("#ftven_formabo_form_email").val();var t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return t.test(u)}function M(n,i){if(n.statut=="OK"){a=true;g(i,"Inscription réussie");e("#ftven_formabo_form_submit").addClass("ftven_formabo_form_submit_finish").click(function(){return false});e("#ftven_formabo_form_email").addClass("ftven_formabo_form_email_finish").prop("disabled",true);var s=new Date;s.setDate(t.getDate()+365);y("ftven-nl-"+r+"_"+p+"_done",1,s)}else{if(false===a){g(false,"Email déjà existant")}}}function _(){if(0===e("#ftven_formabo_form input:checked").length){g(false,"Vous devez sélectionner au moins 1 abonnement");return false}else{return true}}var t=new Date;var n=t.getDay();var r=e("meta[name=archimade_idsite]").attr("content");var i=e("meta[name=archimade_token]").attr("content");var s="http://api.lereferentiel.francetv.fr/users/formulaire-abonnement-newsletter/neolane/subscription";var o="http://api.lereferentiel.francetv.fr/pages/formulaire-abonnement-newsletter/configuration/";var u;var a=false;var f;var l;var c;var h;var p;var d,v;e(document).ready(function(){if(typeof r==="undefined"){return false}if(typeof i==="undefined"){i="default"}var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(false===t){N()}e.urlParam=function(e){var t=(new RegExp("[?&]"+e+"=([^&#]*)")).exec(window.location.href);if(t==null){return null}else{return t[1]||0}};if(e.urlParam("popin")=="1"){console.log("----- The parameter debug popin is active -----");var n=true;N(n)}})})(jQuery)